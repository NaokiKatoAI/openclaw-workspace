# MEMORY.md - 長期記憶

## かっぴーについて
- ECコンサルタントとして活動
- 楽天などのモール + 自社ECの両方を扱うクライアントがいる
- 選択肢はA, B, C形式で出すのが好み
- **初めて飼ったペット**: 犬、名前は「りん」（黒い柴犬）

## セキュリティ設定
- **二要素認証**: 機密ファイル（`~/.ssh/`, `~/.clawdbot/`, `~/Documents/personal/`）アクセス時
  - 質問：「初めて飼ったペットは何？名前も教えて」
  - 答え：犬、りん
- **Allowlist**: かっぴーのみアクセス可能
- **Gateway bind**: loopback（localhost限定）

## モデル設定
- **デフォルト**: Claude Sonnet 4.5
- **コーディング・アプリ開発時**: Claude Opus 4.5（自動切替）
- **画像生成**: Gemini 3 Pro Image
- **フォールバック**: Gemini Flash (google/gemini-3-flash-preview)
- **Anthropic認証**: Claude Pro/Maxサブスクリプション（setup-token）使用中
  - API keyは設定済みだが未使用
  - 使用量0（サブスク枠内で動作）
  - 過去に何度かAPI keyと勘違いしたので注意

## 使えるツール
- **画像生成**: nano-banana-pro (Gemini 3 Pro Image)
- **動画生成**: Remotion (`~/my-video/`)
- **ECコンサルスキル**: `~/Documents/claw-projects/my-repo/skills/ec-consultant/`

## 定期タスク
- **月曜8:00**: AI・ECニュースまとめ配信
- **月曜9:00**: IT・AI補助金情報（週次配信、2026-02-06設定）
  - IT導入補助金、AI関連補助金、事業再構築補助金など
  - 申請期限・補助率・対象事業者などをまとめて配信
  - 通知先: Discord #news
- **深夜0:00**: 日次ログ保存（`memory/YYYY-MM-DD.md`）
- **日曜9:00**: OpenClaw自動アップデート（2026-02-02設定）
  - CHANGELOG解析で破壊的変更を検出
  - 安全なら自動実行＋報告
  - 危険なら内容要約して通知のみ
- **活動時間内（9:00-23:00）**: トークン監視（100k超えで自動保存＆圧縮）
  - 夜間（23:00-9:00）はスキップしてトークン節約
- **コンテキストウィンドウ管理**:
  - 使用率40%超えで通知
  - `/new` 実行時に `history/YYYY-MM-DD_HHMMSS.md` へ自動保存
- **Gmail自動チェック**（2026-02-05設定、2026-02-07改善）:
  - 実行時刻: 8:00, 11:00, 14:00, 17:00, 20:00
  - 通知先: Discord #mail-check
  - リアクション既読化: 👍で既読マーク（最大2回リトライ、3分間隔）
  - スクリプト: `scripts/gmail-monitor.js`, `scripts/gmail-reaction-check.js`
  - 通知形式: 重要メール＋既読候補を1つのメッセージにまとめて、最後に「👍このメッセージにリアクション」と明確指示（2026-02-07改善）
  - 既読化対象: 全メール（重要＋既読候補の両方）（2026-02-07変更）
  - サブスク関係: 重要メールに分類（2026-02-07追加）
    - キーワード: サブスクリプション、定期購読、月額、年額、更新、解約、請求、決済等

## 作業ルール（2026-02-05制定）
- **質問前の確認（最優先）**:
  1. メモリファイル確認（`memory/YYYY-MM-DD.md`, `MEMORY.md`）
  2. 設定ファイル・ログ・スクリプト確認
  3. どうしても分からない場合のみ質問
- **理由**: トークン節約＋人間の時間節約
- **参照**: AGENTS.md「🚨 Confirm Before Asking (Critical Rule)」

## 請求書発行フロー（2026-02-03制定）
- **毎月月初**: 前月分の請求書発行
- **箱根ガラスの森**: 毎月23日にリマインダー（提出期限25日）
- **その他クライアント**: 個別期限は各クライアントのCLIENT_INFO.mdで管理

## Mac設定
- 蓋閉じスリープ防止: `sudo pmset disablesleep 1`（再起動で戻る）

## 作成したもの
- TODOアプリ (`index.html`)
- ec-consultant スキル
- video-creator スキル
- **りんちゃんLP** (`rin-lp/`)：黒柴りんのランディングページ（2026-01-26）
  - レスポンシブ対応、アニメーション付き
  - HTML/CSS/JS（840行）
- **YouTube字幕取得** (`scripts/youtube-subtitle.sh`)：2026-02-01
  - yt-dlpで日本語字幕を自動取得（自動生成字幕にも対応）
  - 動画の内容を要約して活用可能
- **昭和映画フィルターアプリ** (`showa-filter-app/`)：2026-02-06〜07
  - 写真を昭和映画風に加工するWebアプリ
  - Next.js 16 + TypeScript + Tailwind CSS
  - Canvas APIで画像処理（彩度低下、暖色調整、フィルムグレイン、ビネット）
  - プレビュー（透かし入り、低解像度）+ ダウンロード（透かしなし、フル解像度）
  - Supabase認証・DB、Stripeクレジット制サブスク（無料3枚、ライト500円/30枚、プロ1,000円/無制限）
  - 目標：月1万円収益化
  - 状態：全機能実装完了、Supabase + Stripeセットアップ待ち
  - 詳細：`showa-filter-app/SETUP-GUIDE.md`
## クライアント情報管理（2026-02-04変更）
- **保存先**: `WCA-client/[クライアント名]/` にローカル保存（Notion廃止）
- **基本：クライアント横断禁止** — 各クライアントの情報は他クライアントで使わない
- **情報漏洩防止** — メモリファイルには書かない、クライアント専用ディレクトリに隔離

## ファイル構成
```
WCA-client/
├── [クライアント名]/
│   ├── CLIENT_INFO.md（基本情報・契約・請求先）
│   ├── WORK_LOG.md（作業記録・進捗）
│   ├── 提案資料/（PPT・PDF等）
│   └── その他ファイル
```

## 案件ステータス管理
- Discordクライアントチャンネルで「見積もり送った」等のキーワードを検知
- 該当クライアントの `WORK_LOG.md` にタイムスタンプ付きで自動記録

## クライアント情報
- **フロムアイズ**: 定例ミーティングあり、資料作成支援の可能性
  - **稟議番号が必須**（案件ごとに確認が必要）
  - 既知の稟議番号: 9965（3月までのコンサル契約）
- **Bico・GHI**: ウェブカタログ関連
- **AWC（大塚製薬）**: 新規追加（2026-02-01）
- **バルクオム**: ホテルアメニティサイト（2024年制作）、商品追加の可能性
- **ハイマート**: 健康食品サイト＋NGOサイト更新作業（2026-02-01）
- **箱根ガラスの森リゾート**: vetramore（Shopifyサイト、2024年10月オープン）
  - URL: https://hakone-garasunomori-onlineshop.com/
  - 売上管理画面の相談あり
  - 契約：月額50,000円（2026年10月まで）、毎月25日までに請求書提出
  - リマインダー：毎月23日 9:00
- **SB C&S**: 楽天市場の広告運用（DJI等）（2026-02-03追加）
- **ニューレックス**: 進捗確認中

## OpenClaw運用方針
- **ToS違反リスク**: Anthropic Claude Pro/Max使用時、サードパーティツール利用は規約違反の可能性
- **かっぴーの方針**: 公式声明が出るまで様子見、停止されるまで使い倒す
- **Claude Code 2.1.29**: Anthropic公式CLIだが、OpenClawのマルチモデル対応を優先
- **リスク評価**: 定期実行は「常識的な範囲」（1日10回以下）に抑える

## OpenClaw設定最適化（2026-02-05）

**記事参照:** Discord大量データ処理で地獄見た話（てる氏）

**適用した設定：**
1. **memoryFlush（自動メモリ保存）**
   - 100,000トークン超えで自動的に `memory/YYYY-MM-DD.md` に保存
   - prompt: "Write any lasting notes to memory/YYYY-MM-DD.md"

2. **contextPruning（古いツール結果削除）**
   - mode: "cache-ttl", ttl: "5m"
   - 5分経過したツール結果を `[Old tool result cleared]` に置き換え
   - トークン節約＆コンテキスト肥大化防止

3. **historyLimit=0（Discord履歴注入停止）**
   - Discord履歴の自動注入を停止
   - 必要な情報だけを手動で参照

**効果：**
- トークン管理が自動化
- コンテキスト蓄積問題を予防（記事で指摘された290Kトークン問題の対策）
- 落ちにくくなる

**経緯：**
- 2026-02-05早朝、`openclaw update` でcronジョブが一部消失
- Gmail自動チェック（5個）を再設定
- その後、記事を参考に設定最適化を実施

---
*最終更新: 2026-02-07*
