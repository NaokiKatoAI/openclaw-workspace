# 2026-02-11

## 作成物

### Chrome拡張「Images to PDF」
- `image-to-pdf-extension/` に保存
- ページ上の画像を1枚1ページのPDFに変換
- 自動スクロールで遅延読み込み画像も取得
- バックグラウンドService Workerで処理（ポップアップ閉じてもOK）
- キュー方式で複数ジョブ対応、進捗バッジ＋Chrome通知
- 修正履歴: CORS対応→importScripts修正→URL.createObjectURL→キュー方式→サイズ計測修正

### Windows音声入力アプリ
- `voice-input-app/` に保存
- F9キーで録音トグル → faster-whisper → アクティブウィンドウに自動入力
- モデル: `deepdml/faster-whisper-large-v3-turbo-ct2`（CPU動作、高速）
- システムトレイ常駐、`install_autostart.bat` でWindows起動時自動起動
- 修正履歴: VAD感度調整→空認識時VADなし再試行→turboモデル変更→batファイル文字化け修正
- かっぴーのWindows PCで動作確認OK（パス: `C:\Users\katsu\Desktop\Claude code\024_voiceimputapp\`)

## かっぴー情報
- Windows PCも使ってる（ユーザー名: katsu）
- Escape from Tarkovをプレイしている
- GPU搭載PCだがゲーム用なのでGPU負荷を避けたい

### Windows音声入力アプリ（最終仕様）
- ホットキー: F9（GetAsyncKeyStateポーリング方式 — RegisterHotKey/keyboard/pynputは全部NG）
- Ctrl+V送信: `keybd_event` API（pyautoguiもNG）
- オーバーレイ: tkinterキュー方式（別スレッドから直接操作不可）、タスクバー重ね表示、マルチモニター対応
- 認識中はF9無視（processingフラグ）
- 辞書機能: `dictionary.txt`（認識後に自動置換、再起動不要）
- 自動起動: VBScript方式（pythonwはtkinterと相性悪い）
- **重要教訓:** `keyboard`ライブラリがLogicool G Hubのマクロを破壊した → G Hub再インストールで修復

### Windows音声翻訳アプリ
- `voice-translate-app/` に保存（別プロジェクト）
- 日本語音声 → 英語翻訳 → 入力（Helsinki-NLP MarianMT、オフライン）
- ホットキー: F10（voice-input-appと被らないように）
- voice-input-appの全技術知見を反映

## かっぴー情報（追加）
- Logicool G604 LIGHTSPEED使用（多ボタンマウス、G Hub管理）
- マウスにF9、スクショ、Go Back/Forward、Select All、Copy、Paste、Delete等割り当て済み
- デュアルモニター環境

## メモ
- かっぴーからのフィードバック: メッセージ順序に注意（ファイルアップ→説明の順が自然）
- かっぴーからのフィードバック:「再起動」は「黒画面閉じてstart.bat」の意味で使う。PC再起動と紛らわしい
- OpenClawブラウザはサンドボックスでlocalhost接続不可
- Flightradar24等の既存サービスを紹介（プレーンマップ）
- **絶対にkeyboard/pynputライブラリを使わない** — Logicool G Hubを破壊する

## 音声入力アプリ最終修正（完了✅）
- **ホットキー**: F9 → **左Ctrl+右Ctrl同時押し**に変更（G Hub干渉回避）
- **入力方式**: Unicode SendInput → **クリップボード+Ctrl+V（keybd_event）**に変更
  - Unicode SendInputは文字抜けが発生
  - Ctrl+Vが3重になった原因は**Pythonプロセスが3つ残ってた**のが原因（G Hubではなかった）
- **processingフラグ**: 統合完了（認識中のホットキー無視）
- **best_of=5 + initial_prompt追加**: 認識精度向上、英語混入防止
- **教訓**: start.bat実行前にタスクマネージャーでPythonプロセスが1つだけか必ず確認

## 音声入力アプリ追加修正（2026-02-11午後セッション）
- **二重入力の根本原因**: Windows自動起動(VoiceInput.vbs) + 手動start.batで2プロセス起動
- **修正①**: start.batに `taskkill /f /im python.exe` 追加（起動前に全Python終了）
- **修正②**: Python側に `kill_other_instances()` 追加（起動時に自分以外のvoice_input.pyを終了）
- **修正③**: `processing = False` がaudio_data空の早期returnで抜けてた → 追加
- **修正④**: `paste_cooldown_until` 追加（ペースト後1秒間ホットキー無視 → Ctrl+Vの合成キーが録音再開トリガーするのを防止）
- **修正⑤**: `wait_for_modifiers_released()` 追加（ホットキー離すまで待機、GetAsyncKeyState読み取りのみ）

### 🚨 G Hub破壊事故（2回目）
- **原因**: Ctrl+Vを`VK_RCONTROL(0xA3)` + `KEYEVENTF_EXTENDEDKEY`に変更した
- **結果**: G Hubの内部状態テーブルが破壊、マウスボタン動作不良
- **復旧**: G Hub再インストール（2回目）
- **教訓**: `keybd_event`は`VK_CONTROL(0x11)`のみ使用。VK_LCONTROL/VK_RCONTROL/KEYEVENTF_EXTENDEDKEYは絶対NG
- TOOLS.mdに絶対ルールとして明記済み

### 翻訳アプリ相談
- 日本語+英語の両方入力機能を検討中
- DeepL API Free（月50万文字無料）が最有力候補
- 月50万文字 ≒ 毎日約1時間の音声入力分

### かっぴー追加情報
- 会社用マウスを秋葉原で購入（G604とは別）
- 汗疱体質 + 風呂上がり足痒い（温熱蕁麻疹の可能性、塗り薬所持）

### 自分への反省
- 動いてるコードを一度に複数箇所弄って悪化させた（3回連続）
- TOOLS.mdにデバッグルール追記済み
- かっぴーの信頼を損なった。次は1箇所ずつ確実に。

## その他の活動
- **フロムアイズ**: チャットボット設置見積もり ¥20,000 作成・提出予定を記録
- **キャンプ場予約チェック**: 報告ルール更新済み（土曜＋三連休チェック、空きのみ報告）
- **WiFiセキュリティ調査**: かっぴーのWiFi → WPA2 Personal、WPA3への変更を推奨
- **Gmail自動チェック**: 定期実行（8/11/14/17/20時）、17時にoverloadedエラー発生→リトライで復旧
- **セッション履歴バックアップ**: 12時に自動保存完了
